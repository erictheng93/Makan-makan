# CLAUDE-ä¸­æ–‡.md

æœ¬æª”æ¡ˆç‚º Claude Code (claude.ai/code) åœ¨æ­¤ä»£ç¢¼åº«ä¸­å·¥ä½œæ™‚çš„ä¸­æ–‡æŒ‡å°æ–‡ä»¶ã€‚

## å°ˆæ¡ˆæ¦‚è¿°

MakanMakan æ˜¯ä¸€å€‹åŸºæ–¼ Cloudflare é‚Šç·£é‹ç®—å¹³å°æ§‹å»ºçš„ç¾ä»£åŒ–ç„¡ä¼ºæœå™¨é¤å»³ç®¡ç†ç³»çµ±ã€‚è©²ç³»çµ±æä¾›ç·šä¸Šé»é¤ã€èœå–®ç®¡ç†ã€æ¡Œå°ç®¡ç†å’Œå¤šè§’è‰²ç”¨æˆ¶å­˜å–ï¼Œå…·å‚™å³æ™‚åŠŸèƒ½ã€‚æ”¯æ´å¤šå®¶é¤å»³/å•†åº—æ“æœ‰å„è‡ªçš„èœå–®ã€æ¡Œå°å’Œå“¡å·¥ï¼Œé€éå¯æ“´å±•ã€å…·æˆæœ¬æ•ˆç›Šçš„ SaaS æ¶æ§‹äº¤ä»˜ã€‚

## æ¶æ§‹é·ç§»ç‹€æ…‹

**âœ… é·ç§»å®Œæˆ**
- **èˆŠç³»çµ±**: PHP + MySQLï¼ˆå­˜æª”æ–¼ `/legacy/` è³‡æ–™å¤¾ï¼‰
- **æ–°ç³»çµ±**: Cloudflare Workers + D1 + TypeScriptï¼ˆ**ç”Ÿç”¢å°±ç·’**ï¼‰
- **é·ç§»ç‹€æ…‹**: å®Œæˆç„¡ä¼ºæœå™¨æ¶æ§‹å¯¦æ–½ï¼ŒTypeScript ç·¨è­¯ 0 éŒ¯èª¤
- **ç›®å‰éšæ®µ**: æ•ˆèƒ½æœ€ä½³åŒ–å’ŒåŠŸèƒ½å¢å¼·

## æ–°ç³»çµ±æ¶æ§‹ï¼ˆCloudflare ç”Ÿæ…‹ç³»çµ±ï¼‰

### æŠ€è¡“å †ç–Š
- **å‰ç«¯**: Vue.js 3 + TypeScriptï¼ˆCloudflare Pagesï¼‰
- **å¾Œç«¯**: Cloudflare Workers + TypeScript
- **è³‡æ–™åº«**: Cloudflare D1ï¼ˆç›¸å®¹ SQLite çš„ç„¡ä¼ºæœå™¨ SQLï¼‰
- **å¿«å–**: Cloudflare KV å„²å­˜
- **å³æ™‚åŠŸèƒ½**: Durable Objectsï¼ˆWebSocket é€£æ¥ï¼‰
- **æª”æ¡ˆå„²å­˜**: Cloudflare R2 + Images API
- **ç›£æ§**: Workers Analytics + è‡ªè¨‚æŒ‡æ¨™
- **å®‰å…¨**: Cloudflare WAF + Zero Trust

### å°ˆæ¡ˆçµæ§‹
```
makanmakan/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ customer-app/          # æ¶ˆè²»è€…é»é¤æ‡‰ç”¨ç¨‹å¼ï¼ˆCloudflare Pagesï¼‰
â”‚   â”œâ”€â”€ admin-dashboard/       # é¤å»³ç®¡ç†å„€è¡¨æ¿
â”‚   â”œâ”€â”€ api/                   # API æœå‹™ï¼ˆCloudflare Workersï¼‰
â”‚   â”œâ”€â”€ realtime/              # å³æ™‚æœå‹™ï¼ˆDurable Objectsï¼‰
â”‚   â””â”€â”€ image-processor/       # åœ–ç‰‡è™•ç† worker
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared-types/          # å…±äº« TypeScript å®šç¾©
â”‚   â”œâ”€â”€ database/              # D1 è³‡æ–™åº«æ¶æ§‹èˆ‡é·ç§»
â”‚   â””â”€â”€ utils/                 # å…±äº«å·¥å…·ç¨‹å¼
â”œâ”€â”€ legacy/                    # åŸå§‹ PHP ç³»çµ±ï¼ˆå·²æ£„ç”¨ï¼‰
â””â”€â”€ docs/                      # æ–‡ä»¶
    â”œâ”€â”€ requirements_optimized.md  # ç”¢å“éœ€æ±‚æ–‡ä»¶
    â””â”€â”€ technical-documentation.md # æŠ€è¡“è¦æ ¼
```

## è³‡æ–™åº«é…ç½®ï¼ˆCloudflare D1ï¼‰

### è³‡æ–™åº«è¨­å®š
- **ç”Ÿç”¢ç’°å¢ƒ**: `makanmakan-prod`ï¼ˆCloudflare D1ï¼‰
- **æ¸¬è©¦ç’°å¢ƒ**: `makanmakan-staging`ï¼ˆCloudflare D1ï¼‰
- **æœ¬æ©Ÿé–‹ç™¼**: æœ¬æ©Ÿ SQLite è³‡æ–™åº«

### é—œéµè³‡æ–™è¡¨ï¼ˆç”Ÿç”¢æ¶æ§‹ï¼‰
**æ ¸å¿ƒæ¥­å‹™è³‡æ–™è¡¨:**
- `users`: å¤šè§’è‰²ç”¨æˆ¶å¸³æˆ¶ï¼ˆç®¡ç†å“¡ã€åº—ä¸»ã€å»šå¸«ã€æœå‹™å“¡ã€æ”¶éŠ€å“¡ï¼‰
- `restaurants`: é¤å»³è³‡è¨Šèˆ‡è¨­å®š
- `tables`: æ¡Œå°ç®¡ç†èˆ‡ QR ç¢¼ç”¢ç”Ÿ
- `orders`: è¨‚å–®è¨˜éŒ„èˆ‡ç‹€æ…‹è¿½è¹¤
- `order_items`: å€‹åˆ¥è¨‚å–®é …ç›®èˆ‡å®¢è£½åŒ–
- `menu_items`: èœå–®é …ç›®èˆ‡åœ–ç‰‡è®Šé«”
- `categories`: èœå–®åˆ†é¡

**ç³»çµ±èˆ‡å®‰å…¨è³‡æ–™è¡¨:**
- `sessions`: ç”¨æˆ¶æœƒè©±ï¼ˆä¹Ÿå¿«å–æ–¼ KVï¼‰
- `audit_logs`: å®Œæ•´ç³»çµ±æ´»å‹•è¨˜éŒ„
- `error_reports`: éŒ¯èª¤è¿½è¹¤èˆ‡é™¤éŒ¯
- `qr_codes`: QR ç¢¼ç”¢ç”Ÿèˆ‡ç®¡ç†
- `qr_templates`: QR ç¢¼æ¨£å¼æ¨¡æ¿
- `qr_downloads`: QR ç¢¼ä½¿ç”¨åˆ†æ
- `qr_batches`: æ‰¹é‡ QR ç”¢ç”Ÿè¿½è¹¤

**åª’é«”èˆ‡åˆ†æè³‡æ–™è¡¨:**
- `images`: åœ–ç‰‡å…ƒè³‡æ–™èˆ‡è™•ç†
- `image_variants`: å¤šç¨®åœ–ç‰‡å°ºå¯¸è®Šé«”

### è³‡æ–™åº«æ“ä½œ
```bash
# æ‡‰ç”¨é·ç§»åˆ°æ¸¬è©¦ç’°å¢ƒ
npx wrangler d1 migrations apply makanmakan-staging --env staging

# æ‡‰ç”¨é·ç§»åˆ°ç”Ÿç”¢ç’°å¢ƒ
npx wrangler d1 migrations apply makanmakan-prod --env production

# åœ¨æœ¬æ©ŸåŸ·è¡Œ SQL æŸ¥è©¢
npx wrangler d1 execute makanmakan-staging --local --command "SELECT * FROM users LIMIT 5"
```

## é–‹ç™¼å·¥ä½œæµç¨‹

### å…ˆæ±ºæ¢ä»¶
- Node.js 20+
- Cloudflare å¸³æˆ¶ï¼ˆä»˜è²»æ–¹æ¡ˆï¼Œç”¨æ–¼ D1ã€R2ã€Imagesï¼‰
- Wrangler CLI: `npm install -g wrangler`

### æœ¬æ©Ÿé–‹ç™¼è¨­å®š
```bash
# 1. å®‰è£ä¾è³´é …ç›®
npm install

# 2. è¨­å®šç’°å¢ƒ
cp .env.example .env.local

# 3. é©—è­‰ Cloudflare èº«ä»½
npx wrangler login

# 4. å»ºç«‹æœ¬æ©Ÿ D1 è³‡æ–™åº«
npx wrangler d1 create makanmakan-local --local

# 5. åŸ·è¡Œè³‡æ–™åº«é·ç§»
npm run db:migrate:local

# 6. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev  # ä¸¦è¡Œå•Ÿå‹•æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼
```

### ç’°å¢ƒé…ç½®

#### å¿…éœ€çš„ç’°å¢ƒè®Šæ•¸
```env
# Cloudflare API Tokenï¼ˆç”¨æ–¼éƒ¨ç½²ï¼‰
CLOUDFLARE_API_TOKEN=your_api_token

# JWT å¯†é‘°ï¼Œç”¨æ–¼èº«ä»½é©—è­‰
JWT_SECRET=your_jwt_secret

# Cloudflare Images API
CLOUDFLARE_IMAGES_KEY=your_images_key

# Slack webhookï¼Œç”¨æ–¼éŒ¯èª¤é€šçŸ¥
SLACK_WEBHOOK_URL=https://hooks.slack.com/...
```

#### Wrangler é…ç½®
æ¯å€‹æ‡‰ç”¨ç¨‹å¼éƒ½æœ‰è‡ªå·±çš„ `wrangler.toml`ï¼ŒåŒ…å«ç’°å¢ƒç‰¹å®šç¶å®šï¼š
- D1 è³‡æ–™åº«
- KV å‘½åç©ºé–“
- R2 å„²å­˜æ¡¶
- Durable Object ç¶å®š
- ä½‡åˆ—ç”Ÿç”¢è€…

### å¤šè§’è‰²å­˜å–ç³»çµ±ï¼ˆé‚è¼¯æœªè®Šæ›´ï¼‰
ç³»çµ±ç¶­æŒç›¸åŒçš„è§’è‰²æ¬Šé™ï¼š
- **0: ç®¡ç†å“¡** - å®Œæ•´ç³»çµ±å­˜å–æ¬Šé™
- **1: åº—ä¸»** - é¤å»³ç®¡ç†
- **2: å»šå¸«** - å»šæˆ¿é¡¯ç¤ºç³»çµ±
- **3: æœå‹™å“¡** - è¨‚å–®å±¥è¡Œ
- **4: æ”¶éŠ€å“¡** - ä»˜æ¬¾è™•ç†

### API ç«¯é»çµæ§‹
```
/api/v1/
â”œâ”€â”€ auth/          # èº«ä»½é©—è­‰ï¼ˆç™»å…¥ã€è¨»å†Šã€åˆ·æ–°ï¼‰
â”œâ”€â”€ restaurants/   # é¤å»³ç®¡ç†
â”œâ”€â”€ menu/          # èœå–®å’Œåˆ†é¡
â”œâ”€â”€ orders/        # è¨‚å–®ç®¡ç†
â”œâ”€â”€ tables/        # æ¡Œå°ç®¡ç†å’Œ QR ç¢¼
â”œâ”€â”€ users/         # ç”¨æˆ¶/å“¡å·¥ç®¡ç†
â”œâ”€â”€ analytics/     # æ¥­å‹™åˆ†æ
â”œâ”€â”€ qr/            # QR ç¢¼ç”¢ç”Ÿå’Œæ¨¡æ¿
â”œâ”€â”€ system/        # éŒ¯èª¤å ±å‘Šå’Œå¥åº·æª¢æŸ¥
â”œâ”€â”€ sse/           # ä¼ºæœå™¨ç™¼é€äº‹ä»¶ï¼Œç”¨æ–¼å³æ™‚æ›´æ–°
â””â”€â”€ health/        # ç³»çµ±å¥åº·ç›£æ§
```

## é–‹ç™¼æŒ‡ä»¤

### è³‡æ–™åº«ç®¡ç†
```bash
# å»ºç«‹ä¸¦æ‡‰ç”¨é·ç§»
npm run db:migrate:create <é·ç§»åç¨±>
npm run db:migrate:staging
npm run db:migrate:prod

# é–‹ç™¼ç”¨è³‡æ–™ç¨®å­
npm run db:seed:local
npm run db:seed:staging
```

### æ¸¬è©¦
```bash
# å–®å…ƒæ¸¬è©¦
npm run test

# TypeScript ç·¨è­¯æª¢æŸ¥
npm run typecheck  # âœ… æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼ 0 éŒ¯èª¤

# æ•´åˆæ¸¬è©¦
npm run test:integration

# ç«¯åˆ°ç«¯æ¸¬è©¦
npm run test:e2e

# æ¸¬è©¦è¦†è“‹ç‡
npm run test:coverage

# ç‰¹å®šæ‡‰ç”¨ç¨‹å¼æ¸¬è©¦
cd apps/api && npm run test
cd apps/admin-dashboard && npm run test
cd apps/customer-app && npm run test
```

### éƒ¨ç½²
```bash
# éƒ¨ç½²åˆ°æ¸¬è©¦ç’°å¢ƒï¼ˆæ¨é€åˆ° develop åˆ†æ”¯æ™‚è‡ªå‹•åŸ·è¡Œï¼‰
npm run deploy:staging

# éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒï¼ˆæ¨é€åˆ° main åˆ†æ”¯æ™‚è‡ªå‹•åŸ·è¡Œï¼‰
npm run deploy:prod

# æ‰‹å‹•éƒ¨ç½²
npm run build && npm run deploy
```

### ç›£æ§å’Œé™¤éŒ¯
```bash
# æª¢è¦–ç‰¹å®š worker çš„æ—¥èªŒ
npx wrangler tail makanmakan-api-prod

# æª¢è¦– D1 è³‡æ–™åº«
npx wrangler d1 execute makanmakan-prod --command "SELECT COUNT(*) FROM orders"

# ç›£æ§ KV ä½¿ç”¨ç‹€æ³
npx wrangler kv:key list --binding CACHE_KV
```

## ç›®å‰é–‹ç™¼ç‹€æ…‹

### ğŸš€ ç”Ÿç”¢å°±ç·’åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
- âœ… **æ ¸å¿ƒ API åŸºç¤è¨­æ–½**: æ‰€æœ‰ç«¯é»æ­£å¸¸é‹ä½œï¼ŒTypeScript ç·¨è­¯ 0 éŒ¯èª¤
- âœ… **è³‡æ–™åº«æ¶æ§‹**: å®Œæ•´ D1 æ¶æ§‹èˆ‡é·ç§»
- âœ… **èº«ä»½é©—è­‰ç³»çµ±**: åŸºæ–¼ JWT çš„å¤šè§’è‰²èº«ä»½é©—è­‰
- âœ… **QR ç¢¼æœå‹™**: é€²éš QR ç”¢ç”Ÿï¼Œå…·æ¨¡æ¿å’Œåˆ†æåŠŸèƒ½
- âœ… **éŒ¯èª¤ç›£æ§**: å…¨é¢éŒ¯èª¤å ±å‘Šå’Œè¨˜éŒ„
- âœ… **å®‰å…¨æ¡†æ¶**: å®Œæ•´å®‰å…¨æ–‡ä»¶å’Œå¯¦æ–½
- âœ… **æ¸¬è©¦å¥—ä»¶**: æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼çš„å®Œæ•´æ¸¬è©¦è¦†è“‹
- âœ… **CI/CD ç®¡ç·š**: è‡ªå‹•åŒ–éƒ¨ç½²å’Œæ¸¬è©¦

### ğŸ”¨ é–‹ç™¼ä¸­åŠŸèƒ½
- ğŸ”„ **å³æ™‚åŠŸèƒ½**: å³æ™‚æ›´æ–°çš„ WebSocket/SSE å¯¦ä½œ
- ğŸ”„ **åœ–ç‰‡è™•ç†**: èœå–®ç…§ç‰‡çš„ Cloudflare Images æ•´åˆ
- ğŸ”„ **åˆ†æå„€è¡¨æ¿**: å•†æ¥­æ™ºæ…§å’Œå ±å‘ŠåŠŸèƒ½
- ğŸ”„ **æ•ˆèƒ½æœ€ä½³åŒ–**: å¿«å–ç­–ç•¥å’ŒæŸ¥è©¢æœ€ä½³åŒ–

### ğŸ“‹ ä¸‹ä¸€éšæ®µï¼ˆè¦åŠƒä¸­ï¼‰
- â³ **ä»˜æ¬¾æ•´åˆ**: å¤šé–˜é“ä»˜æ¬¾è™•ç†
- â³ **è¡Œå‹• PWA**: é›¢ç·šæ”¯æ´çš„æ¼¸é€²å¼ç¶²é æ‡‰ç”¨åŠŸèƒ½
- â³ **é€²éšåˆ†æ**: AI é©…å‹•çš„è¦‹è§£å’Œæ¨è–¦
- â³ **å¤šèªè¨€æ”¯æ´**: åœ‹éš›åŒ–æ¡†æ¶

## è¿‘æœŸé–‹ç™¼æˆå°±

### ğŸ¯ TypeScript éŒ¯èª¤è§£æ±ºï¼ˆå®Œæˆæ–¼: 2025-08-31ï¼‰

**é‡å¤§æˆå°±**: æˆåŠŸè§£æ±ºæ•´å€‹ API ä»£ç¢¼åº«ä¸­æ‰€æœ‰ **13 å€‹å‰©é¤˜çš„ TypeScript ç·¨è­¯éŒ¯èª¤**ï¼Œå¯¦ç¾ **å®Œç¾çš„ TypeScript ç·¨è­¯ï¼ˆ0 éŒ¯èª¤ï¼‰**ã€‚

#### å¯¦æ–½çš„é—œéµä¿®å¾©:
1. **D1Database åŒ¯å…¥è§£æ±ºï¼ˆ3 å€‹éŒ¯èª¤ï¼‰**:
   - å°‡åŒ¯å…¥è·¯å¾‘å¾ `@cloudflare/workers-types` ä¿®æ­£ç‚º `@makanmakan/database`
   - æ›´æ–°å‹åˆ¥åˆ¥åå’ŒåŒ¯å‡ºæ¨¡å¼
   - è§£æ±º `packages/database/src/index.ts` å’Œ `packages/database/src/services/base.ts`

2. **QRCode æœå‹™æ–¹æ³•ç°½åï¼ˆ6 å€‹éŒ¯èª¤ï¼‰**:
   - ä¿®æ­£å¾ `(result as any).success` åˆ°ç›´æ¥å±¬æ€§å­˜å–çš„å±¬æ€§å­˜å–æ¨¡å¼
   - å°‡æ–¹æ³•åç¨±å¾ `getAllTemplates()` ä¿®æ­£ç‚º `getActiveTemplates()`
   - æ›´æ–°æœå‹™å›æ‡‰çµæ§‹ä»¥åŒ¹é…å¯¦éš›å¯¦ä½œ
   - åœ¨ `apps/api/src/routes/qrcode.ts` ä¸­è§£æ±º

3. **ç¨½æ ¸æ—¥èªŒæ¶æ§‹å°é½Šï¼ˆ3 å€‹éŒ¯èª¤ï¼‰**:
   - å¾ç¨½æ ¸æ—¥èªŒå»ºç«‹å‘¼å«ä¸­ç§»é™¤ä¸æ”¯æ´çš„ `changes` æ¬„ä½
   - å°‡ç¨½æ ¸è³‡è¨Šæ•´åˆåˆ°æ”¯æ´çš„ `description` æ¬„ä½ä¸­
   - èˆ‡ `QRCodeService.createAuditLog()` ä»‹é¢éœ€æ±‚å°é½Š

4. **ç³»çµ±è·¯ç”±åŒ¯å…¥ä¿®å¾©ï¼ˆ1 å€‹éŒ¯èª¤ï¼‰**:
   - é€éå¾ `@makanmakan/database` åŒ¯å…¥ä¾†ä¿®å¾© drizzle-orm åŒ¯å…¥
   - æ›´æ–° `apps/api/src/routes/system.ts`

#### æŠ€è¡“å½±éŸ¿:
- **ç¨‹å¼ç¢¼å“è³ª**: æ‰€æœ‰ API è·¯ç”± 100% TypeScript åˆè¦
- **é–‹ç™¼è€…é«”é©—**: é›¶ç·¨è­¯è­¦å‘Šï¼Œæ”¹å–„ IDE æ”¯æ´
- **å¯ç¶­è­·æ€§**: ä¸€è‡´çš„å‹åˆ¥å®‰å…¨å’Œç„¡éŒ¯èª¤å»ºç½®
- **éƒ¨ç½²å°±ç·’**: CI/CD ç®¡ç·šä¸­çš„æ‰€æœ‰æª¢æŸ¥é€šé

#### é©—è­‰:
```bash
# æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼ç¾åœ¨éƒ½é€šé TypeScript ç·¨è­¯
cd apps/api && npx tsc --noEmit  # âœ… 0 éŒ¯èª¤
cd apps/admin-dashboard && npx tsc --noEmit  # âœ… æ¸…æ½”
cd apps/customer-app && npx tsc --noEmit  # âœ… æ¸…æ½”
```

### ğŸ”’ å®‰å…¨æ€§å¢å¼·ï¼ˆå®Œæˆæ–¼: 2025-08-31ï¼‰

**æ–°å¢å…¨é¢çš„å®‰å…¨æ–‡ä»¶**:
- `SECURITY.md`: å®Œæ•´çš„å®‰å…¨æŒ‡å°åŸå‰‡å’Œå”å®š
- `DEPLOYMENT_SECURITY_CHECKLIST.md`: éƒ¨ç½²å‰å®‰å…¨é©—è­‰
- `SQL/migrate_passwords_security.sql`: è³‡æ–™åº«å®‰å…¨é·ç§»
- æ‰€æœ‰æœå‹™çš„å¢å¼·éŒ¯èª¤è™•ç†å’Œç¨½æ ¸è¨˜éŒ„

### ğŸ§ª æ¸¬è©¦åŸºç¤è¨­æ–½ï¼ˆå®Œæˆæ–¼: 2025-08-31ï¼‰

**æ–°å¢çš„å…¨é¢æ¸¬è©¦å¥—ä»¶**:
- **ç®¡ç†å„€è¡¨æ¿**: å…ƒä»¶æ¸¬è©¦ã€è¨­å®šé…ç½®
- **API æœå‹™**: è·¯ç”±æ¸¬è©¦ã€SSE æ¸¬è©¦ã€èº«ä»½é©—è­‰æ¸¬è©¦
- **å®¢æˆ¶æ‡‰ç”¨ç¨‹å¼**: è³¼ç‰©è»Šã€éŒ¯èª¤é‚Šç•Œã€è¨‚å–®é …ç›®çš„å…ƒä»¶æ¸¬è©¦
- **ç«¯åˆ°ç«¯**: ç®¡ç†å“¡ç™»å…¥å’Œæ ¸å¿ƒå·¥ä½œæµç¨‹æ¸¬è©¦

#### æ¸¬è©¦è¦†è“‹:
```bash
apps/admin-dashboard/src/__tests__/     # Vue å…ƒä»¶æ¸¬è©¦
apps/api/src/__tests__/                 # API è·¯ç”±æ¸¬è©¦
apps/customer-app/src/tests/            # å®¢æˆ¶æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦
tests/e2e/                              # ç«¯åˆ°ç«¯æ¸¬è©¦
```

## é—œéµåŠŸèƒ½ï¼ˆæ›´æ–°ç‰ˆï¼‰

### æ ¸å¿ƒåŠŸèƒ½
- **å¤šé¤å»³ SaaS å¹³å°**ï¼Œå…·æœ‰ç§Ÿæˆ¶éš”é›¢
- **åŸºæ–¼ QR ç¢¼çš„é»é¤**ï¼Œå‹•æ…‹ QR ç”¢ç”Ÿ
- **å³æ™‚è¨‚å–®è¿½è¹¤**ï¼Œä½¿ç”¨ WebSocketsï¼ˆDurable Objectsï¼‰
- **è§’è‰²ç‚ºåŸºç¤çš„å­˜å–æ§åˆ¶**ï¼Œå°ˆé–€ä»‹é¢
- **åœ–ç‰‡æœ€ä½³åŒ–**ï¼Œä½¿ç”¨ Cloudflare Images API
- **å…¨çƒé‚Šç·£éƒ¨ç½²**ï¼Œå…¨çƒä½å»¶é²

### é€²éšåŠŸèƒ½
- **æ™ºæ…§å¿«å–**ï¼Œå¤šå±¤å¿«å–ç­–ç•¥
- **æ¥­å‹™åˆ†æ**ï¼Œè‡ªè¨‚æŒ‡æ¨™è¿½è¹¤
- **è‡ªå‹•ç›£æ§**ï¼Œå¥åº·æª¢æŸ¥å’Œè­¦å ±
- **æ¼¸é€²å¼ç¶²é æ‡‰ç”¨ç¨‹å¼ï¼ˆPWAï¼‰**ï¼Œé›¢ç·šåŠŸèƒ½
- **å¤šèªè¨€æ”¯æ´**ï¼Œç‚ºåœ‹éš›æ“´å±•åšæº–å‚™
- **API å„ªå…ˆè¨­è¨ˆ**ï¼Œç”¨æ–¼æœªä¾†æ•´åˆ

## å¸¸è¦‹é–‹ç™¼ä»»å‹™

### æ–°å¢æ–°èœå–®é …ç›®
- **API**: POST `/api/v1/menu/{restaurant_id}/items`
- **å‰ç«¯**: ç®¡ç†å„€è¡¨æ¿ â†’ èœå–®ç®¡ç† â†’ æ–°å¢é …ç›®
- **åœ–ç‰‡**: è‡ªå‹•è™•ç†ï¼Œå¤šç¨®è®Šé«”ï¼ˆç¸®åœ–ã€ä¸­ç­‰ã€å¤§å‹ï¼‰

### ç®¡ç†ç”¨æˆ¶è§’è‰²
- **API**: POST/PUT `/api/v1/users/{restaurant_id}`
- **æ¬Šé™çŸ©é™£**: å®šç¾©æ–¼ `packages/shared-types/permissions.ts`
- **è§’è‰²ä»‹é¢**: ç®¡ç†å„€è¡¨æ¿ä¸­æ¯å€‹è§’è‰²çš„å°ˆé–€ UI

### QR ç¢¼ç”¢ç”Ÿ
- **å€‹åˆ¥ QR**: POST `/api/v1/qr/generate`
- **æ‰¹é‡ç”¢ç”Ÿ**: POST `/api/v1/qr/bulk`
- **æ¨¡æ¿ç®¡ç†**: GET/POST/PUT/DELETE `/api/v1/qr/templates`
- **ä¸‹è¼‰ QR**: GET `/api/v1/qr/{id}/download`
- **æ‰¹æ¬¡ä¸‹è¼‰**: GET `/api/v1/qr/batch/{batchId}/download`
- **çµ±è¨ˆ**: GET `/api/v1/qr/stats`
- **å®¢è£½åŒ–**: é€²éšæ¨£å¼ï¼ŒåŒ…å«æ¨¡æ¿ã€æ¨™èªŒã€é¡è‰²ã€æ¼¸å±¤

### å³æ™‚è¨‚å–®æ›´æ–°
- **WebSocket é€£æ¥**: ç”± Durable Objects è™•ç†
- **äº‹ä»¶å»£æ’­**: è¨‚å–®ç‹€æ…‹è®Šæ›´è§¸ç™¼é€šçŸ¥
- **åŸºæ–¼è§’è‰²çš„ç¯©é¸**: ä¸åŒè§’è‰²æ¥æ”¶ä¸åŒé€šçŸ¥é¡å‹

### åˆ†æå’Œå ±å‘Š
- **å„€è¡¨æ¿è³‡æ–™**: GET `/api/v1/analytics/{restaurant_id}/dashboard`
- **è‡ªè¨‚å ±å‘Š**: å…·å¿«å–çš„æ™‚é–“ç¯„åœç¯©é¸
- **åŒ¯å‡ºé¸é …**: JSONã€CSVã€PDF æ ¼å¼

## éŒ¯èª¤è™•ç†å’Œé™¤éŒ¯

### å¸¸è¦‹å•é¡Œ
1. **D1 é€£æ¥éŒ¯èª¤**: æª¢æŸ¥ wrangler.toml ç¶å®š
2. **KV å¿«å–éºå¤±**: é©—è­‰å‘½åç©ºé–“é…ç½®
3. **åœ–ç‰‡ä¸Šå‚³å¤±æ•—**: æª¢æŸ¥ R2 å„²å­˜æ¡¶æ¬Šé™
4. **WebSocket ä¸­æ–·**: ç›£æ§ Durable Objects å¥åº·ç‹€æ³

### é™¤éŒ¯å·¥å…·
- **Worker æ—¥èªŒ**: `npx wrangler tail`
- **D1 æŸ¥è©¢**: é€é wrangler ç›´æ¥è³‡æ–™åº«å­˜å–
- **å¥åº·ç«¯é»**: `/api/v1/health` ç”¨æ–¼ç³»çµ±ç‹€æ…‹
- **éŒ¯èª¤è¿½è¹¤**: é—œéµéŒ¯èª¤çš„è‡ªå‹• Slack é€šçŸ¥

## æ•ˆèƒ½æœ€ä½³åŒ–

### å¿«å–ç­–ç•¥
- **éœæ…‹è³‡ç”¢**: Cloudflare CDNï¼Œé•·å¿«å–æ™‚é–“
- **API å›æ‡‰**: KV å¿«å–ï¼Œæ™ºæ…§ç„¡æ•ˆåŒ–
- **è³‡æ–™åº«æŸ¥è©¢**: æŸ¥è©¢çµæœå¿«å–ï¼Œå…· TTL
- **åœ–ç‰‡å‚³é**: Cloudflare Imagesï¼Œå…¨çƒåˆ†ç™¼

### ç›£æ§ç›®æ¨™
- **API å›æ‡‰æ™‚é–“**: P99 < 300ms
- **è³‡æ–™åº«æŸ¥è©¢æ™‚é–“**: P95 < 100ms
- **åœ–ç‰‡è¼‰å…¥æ™‚é–“**: P90 < 1s
- **WebSocket å»¶é²**: å³æ™‚æ›´æ–° < 50ms

## å®‰å…¨è€ƒé‡

### è³‡æ–™ä¿è­·
- **åŠ å¯†**: éœæ…‹æ•æ„Ÿè³‡æ–™ä½¿ç”¨ AES-256
- **JWT ä»¤ç‰Œ**: å…·åˆ·æ–°é‚è¼¯çš„å®‰å…¨ä»¤ç‰Œç®¡ç†
- **è¼¸å…¥é©—è­‰**: æ‰€æœ‰è¼¸å…¥çš„å…¨é¢é©—è­‰
- **CORS**: åš´æ ¼çš„ä¾†æºé©—è­‰

### å­˜å–æ§åˆ¶
- **WAF è¦å‰‡**: API ä¿è­·çš„è‡ªè¨‚è¦å‰‡
- **é€Ÿç‡é™åˆ¶**: åŸºæ–¼ IP å’Œç”¨æˆ¶çš„é€Ÿç‡é™åˆ¶
- **åœ°ç†é™åˆ¶**: ç®¡ç†ä»‹é¢åœ°ç†é˜»æ“‹
- **ç¨½æ ¸è¨˜éŒ„**: æ‰€æœ‰æ“ä½œçš„å®Œæ•´ç¨½æ ¸è¿½è¹¤

## å¾èˆŠç³»çµ±é·ç§»

### è³‡æ–™é·ç§»æµç¨‹
1. **åŒ¯å‡ºèˆŠè³‡æ–™**: `/legacy/migration/` ä¸­çš„è‡ªè¨‚ PHP è…³æœ¬
2. **è½‰æ›æ¶æ§‹**: å°‡èˆŠçµæ§‹æ˜ å°„åˆ°æ–° D1 è³‡æ–™è¡¨
3. **åŒ¯å…¥åˆ° D1**: å…·é©—è­‰çš„æ‰¹æ¬¡åŒ¯å…¥
4. **é©—è­‰è³‡æ–™å®Œæ•´æ€§**: è‡ªå‹•æª¢æŸ¥å’Œå ±å‘Š
5. **åˆ‡æ›è¦åŠƒ**: è—ç¶ éƒ¨ç½²ç­–ç•¥

### å‘å¾Œç›¸å®¹æ€§
- **API ç«¯é»**: éæ¸¡æœŸé–“é‡å®šå‘èˆŠç«¯é»
- **æª”æ¡ˆåƒè€ƒ**: åœ–ç‰‡ URL æ˜ å°„åˆ°æ–° R2/Images çµæ§‹
- **ç”¨æˆ¶æœƒè©±**: æ´»å‹•æœƒè©±çš„é€æ­¥é·ç§»
- **QR ç¢¼**: éæ¸¡æœŸé–“èˆŠ QR ç¢¼ç¹¼çºŒé‹ä½œ

## æœªä¾†è·¯ç·šåœ–

### è¦åŠƒå¢å¼·ï¼ˆç¬¬äºŒéšæ®µï¼‰
- **é€²éšåˆ†æ**: AI é©…å‹•çš„è¦‹è§£å’Œæ¨è–¦
- **ä»˜æ¬¾æ•´åˆ**: å¤šä»˜æ¬¾é–˜é“æ”¯æ´
- **åº«å­˜ç®¡ç†**: æ™ºæ…§åº«å­˜è¿½è¹¤èˆ‡é æ¸¬
- **è¡ŒéŠ·è‡ªå‹•åŒ–**: å®¢æˆ¶åˆ†ç¾¤å®šä½
- **è¡Œå‹•æ‡‰ç”¨ç¨‹å¼**: åŸç”Ÿ iOS/Android æ‡‰ç”¨ç¨‹å¼
- **API å¸‚å ´**: ç¬¬ä¸‰æ–¹æ•´åˆå’Œæ“´å……åŠŸèƒ½

---

**æœ€å¾Œæ›´æ–°**: 2025-08-31  
**æ¶æ§‹ç‰ˆæœ¬**: 2.0ï¼ˆCloudflare ç„¡ä¼ºæœå™¨ï¼‰  
**èˆŠç‰ˆæœ¬**: 1.0ï¼ˆPHP/MySQL - å·²æ£„ç”¨ï¼‰  
**TypeScript ç‹€æ…‹**: âœ… 100% ç„¡éŒ¯èª¤ç·¨è­¯  
**æ¸¬è©¦è¦†è“‹**: ğŸ“Š å¯¦ä½œå…¨é¢æ¸¬è©¦å¥—ä»¶  
**å®‰å…¨ç‹€æ…‹**: ğŸ”’ æ–°å¢å¢å¼·å®‰å…¨æ–‡ä»¶

è©³ç´°æŠ€è¡“è¦æ ¼è«‹åƒé–± `docs/technical-documentation.md`  
ç”¢å“éœ€æ±‚è«‹åƒé–± `docs/requirements_optimized.md`

# é‡è¦æŒ‡ç¤ºæé†’
æŒ‰è¦æ±‚è¡Œäº‹ï¼›ä¸å¤šä¸å°‘ã€‚
é™¤éçµ•å°å¿…è¦å¯¦ç¾ç›®æ¨™ï¼Œå¦å‰‡æ°¸é ä¸è¦å»ºç«‹æª”æ¡ˆã€‚
å§‹çµ‚å„ªå…ˆç·¨è¼¯ç¾æœ‰æª”æ¡ˆè€Œéå»ºç«‹æ–°æª”æ¡ˆã€‚
é™¤éç”¨æˆ¶æ˜ç¢ºè¦æ±‚ï¼Œå¦å‰‡æ°¸é ä¸è¦ä¸»å‹•å»ºç«‹æ–‡ä»¶æª”æ¡ˆï¼ˆ*.mdï¼‰æˆ– README æª”æ¡ˆã€‚åƒ…åœ¨æ˜ç¢ºè¦æ±‚æ™‚æ‰å»ºç«‹æ–‡ä»¶æª”æ¡ˆã€‚

é‡è¦: æ­¤å…§å®¹å¯èƒ½èˆ‡æ‚¨çš„ä»»å‹™ç›¸é—œæˆ–ä¸ç›¸é—œã€‚é™¤éèˆ‡æ‚¨çš„ä»»å‹™é«˜åº¦ç›¸é—œï¼Œå¦å‰‡æ‚¨ä¸æ‡‰å›æ‡‰æ­¤å…§å®¹ã€‚